

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>BytecodeEscapeAnalysis &mdash; OpenJDK Internals 1.0 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="OpenJDK Internals 1.0 documentation" href="../index.html" />
    <link rel="next" title="Profiling" href="profiling.html" />
    <link rel="prev" title="Devirtualization" href="devirtualize.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>OpenJDK Internals 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>BytecodeEscapeAnalysis</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="devirtualize.html">Devirtualization</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="profiling.html">Profiling</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="bytecodeescapeanalysis">
<h1>BytecodeEscapeAnalysis<a class="headerlink" href="#bytecodeescapeanalysis" title="Permalink to this headline">¶</a></h1>
<p>HotSpotには、2種類のEscapeAnlaysisを実装している。</p>
<div class="section" id="ci-bcescapeanalyzer">
<h2>ci/bcEscapeAnalyzer<a class="headerlink" href="#ci-bcescapeanalyzer" title="Permalink to this headline">¶</a></h2>
<p>oops中のBytecodeを解析する</p>
</div>
<div class="section" id="opto-escape">
<h2>opto/escape<a class="headerlink" href="#opto-escape" title="Permalink to this headline">¶</a></h2>
<p>Idealを解析する</p>
<p>opto/escape.hpp</p>
<div class="highlight-python"><pre>//
// Adaptation for C2 of the escape analysis algorithm described in:
//
// [Choi99] Jong-Deok Shoi, Manish Gupta, Mauricio Seffano,
//          Vugranam C. Sreedhar, Sam Midkiff,
//          "Escape Analysis for Java", Procedings of ACM SIGPLAN
//          OOPSLA  Conference, November 1, 1999
//
// The flow-insensitive analysis described in the paper has been implemented.
//
// The analysis requires construction of a "connection graph" (CG) for
// the method being analyzed.  The nodes of the connection graph are:
//
//     -  Java objects (JO)
//     -  Local variables (LV)
//     -  Fields of an object (OF),  these also include array elements
//
// The CG contains 3 types of edges:
//
//   -  PointsTo  (-P&gt;)    {LV, OF} to JO
//   -  Deferred  (-D&gt;)    from {LV, OF} to {LV, OF}
//   -  Field     (-F&gt;)    from JO to OF</pre>
</div>
<div class="section" id="id1">
<h3>ci/bcEscapeAnalyzerの詳細<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>opto/escapeから補助的に呼ばれ、 bytecodeのstore命令や、put等を解析する。</p>
<p>IdealのCallNodeがstaticだった場合に、BCEscapeAnalyzerを使用する</p>
<p>opto/escape.cpp</p>
<div class="highlight-python"><pre>case Op_CallStaticJava:
// For a static call, we know exactly what method is being called.
// Use bytecode estimator to record the call's escape affects
{
  ciMethod *meth = call-&gt;as_CallJava()-&gt;method();
  BCEscapeAnalyzer *call_analyzer = (meth !=NULL) ? meth-&gt;get_bcea() : NULL;</pre>
</div>
<p>Bytecodesをブロック単位でイテレートしながら、解析する</p>
<p>set_xxx()でフラグ操作が追えるけど、なんかの論文読んだ方が詳細を理解するのは早いかも</p>
</div>
<div class="section" id="id2">
<h3>opto/escapeの詳細<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>あとで</p>
</div>
<div class="section" id="escapeanalysis">
<h3>EscapeAnalysisの解析結果<a class="headerlink" href="#escapeanalysis" title="Permalink to this headline">¶</a></h3>
<p>UnknownEscape</p>
<p>GlobalEscape</p>
<p>ArgEscape</p>
<p>NoEscape</p>
</div>
<div class="section" id="id3">
<h3>EscapeAnalysisの解析結果の活用方法<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>EscapeAnalysisの活用方法は、2つある。</p>
<p>解析結果であるEscapeStateは、Idealのnode-&gt;escape_state() で取得できる。</p>
<ol class="arabic simple">
<li>LockNode/UnlockNodeの削除</li>
</ol>
<blockquote>
<div><p>callnode.cppに処理が記述してある。</p>
<p>LockやUnlockのNodeは、対象のオブジェクトがGlobalEscapeで無ければ削除可能である</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>is_scalar_replaceable()</li>
</ol>
<blockquote>
<div><p>opto/escape.cpp:compute_escape()において、EscapeAnalysisが終わった後、split_unique_types()でis_scalar_replaceableを立てて歩く</p>
<p>後々のフェーズであるPhaseMacroExpand::eliminate_allocate_node()の解析が走り、可能であればallocを削除する</p>
<p>bool PhaseMacroExpand::scalar_replacement()</p>
<p>オプションで様子を眺める場合、PrintEliminateAllocationsで可能なはず</p>
</div></blockquote>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="devirtualize.html">Devirtualization</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="profiling.html">Profiling</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer">
        &copy; Copyright 2011, nothingcosmos.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>

<script type="text/javascript">

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-15223787-2']);
_gaq.push(['_trackPageview']);

(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();

</script>


  </body>
</html>